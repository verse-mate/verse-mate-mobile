---
appId: org.versemate.app
name: Skeleton Flash Test - Explanations View
description: Tests that skeleton doesn't flash when swiping in Explanations view with cached data
tags:
  - skeleton
  - explanations
  - visual
  - regression

---

# Skeleton Flash Test - Explanations View
#
# This flow tests that skeleton loading doesn't flash unnecessarily
# when swiping between chapters in Explanations view when data is cached.
#
# User Journey:
# 1. Launch app to Genesis 1
# 2. Switch to Explanations view
# 3. Wait for explanation to load (ensure it's cached)
# 4. Swipe to Genesis 2 (trigger cache + new fetch)
# 5. Verify no skeleton flash during transition
# 6. Verify explanation content appears smoothly
#
# Expected Behavior:
# - Should show old chapter content (Genesis 1) during swipe
# - Should smoothly transition to new chapter content (Genesis 2)
# - Should NOT show skeleton loader between transitions
# - Header should update at same time as content updates

- runFlow: ../shared/setup.yaml

# Wait for chapter to load - verify chapter selector is visible
- assertVisible:
    id: "chapter-selector-button"

# Wait for content to load
- waitForAnimationToEnd


# Switch to Explanations view by tapping the explanations icon
- tapOn:
    id: "commentary-view-toggle"

# Wait for explanations to load
- waitForAnimationToEnd


# Verify we're in Explanations view (tabs should be visible)
- assertVisible:
    id: "chapter-content-tabs"

# Wait a moment to ensure explanation is cached
- waitForAnimationToEnd


# Take screenshot before swipe
- takeScreenshot: before-swipe-chapter-1

# Swipe left to go to next chapter
# This is the critical moment - we should NOT see skeleton flash
- swipe:
    direction: LEFT
    duration: 500

# Wait for animation to complete
- waitForAnimationToEnd


# Take screenshot after swipe
- takeScreenshot: after-swipe-chapter-2

# Verify chapter selector button is visible (chapter loaded)
- assertVisible:
    id: "chapter-selector-button"

# Verify we're still in Explanations view (tabs visible)
- assertVisible:
    id: "chapter-content-tabs"

# CRITICAL: Verify skeleton loader is NOT visible
# If skeleton is visible, it means the flash happened
- assertNotVisible:
    id: "skeleton-loader"

# Swipe left again to next chapter (test consecutive swipes)
- swipe:
    direction: LEFT
    duration: 500

- waitForAnimationToEnd


# Take screenshot after second swipe
- takeScreenshot: after-swipe-chapter-3

# Verify chapter selector button still visible
- assertVisible:
    id: "chapter-selector-button"

# CRITICAL: Again verify skeleton is not visible
- assertNotVisible:
    id: "skeleton-loader"

# Swipe right back to previous chapter (test reverse direction)
- swipe:
    direction: RIGHT
    duration: 500

- waitForAnimationToEnd


# Take screenshot after reverse swipe
- takeScreenshot: after-swipe-back-chapter-2

# Verify chapter selector button visible
- assertVisible:
    id: "chapter-selector-button"

# CRITICAL: Skeleton should not be visible
- assertNotVisible:
    id: "skeleton-loader"

# Switch back to Bible view to verify view switching works
- tapOn:
    id: "bible-view-toggle"

- waitForAnimationToEnd


# Tabs should not be visible in Bible view
- assertNotVisible:
    id: "chapter-content-tabs"

# Verify Bible content is visible (not skeleton)
- assertNotVisible:
    id: "skeleton-loader"
