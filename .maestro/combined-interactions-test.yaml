---
appId: org.versemate.app
name: Combined Interactions Test
description: Tests header sync through combined navigation patterns (modal + swipe + deep link)
tags:
  - header-sync
  - navigation
  - combined
  - critical
  - regression

---

# Combined Interactions Header Sync E2E Test
#
# This flow tests header/content sync through a complex sequence of interactions:
# - Deep link -> swipe -> modal jump -> swipe -> repeated patterns
# - Verifies header remains in sync throughout entire sequence
# - Tests the most complex real-world usage patterns
#
# User Journey:
# 1. Navigate to Psalms 23 (simulated deep link)
# 2. Swipe forward to Psalms 24
# 3. Jump to Exodus 20 via modal
# 4. Swipe forward to Exodus 21
# 5. Jump to Matthew 5 via modal
# 6. Rapid swipe sequence
# 7. Return to original chapter
#
# Success Criteria:
# - Header remains perfectly in sync throughout entire sequence
# - No desync at any transition point
# - Complex combined interactions don't cause state corruption

# ============================================
# Test Setup: Launch App
# ============================================

- launchApp:
    appId: org.versemate.app

# For development builds: dismiss dev menu if shown
- tapOn:
    text: "http://localhost:8081"
    optional: true

- tapOn:
    text: "Continue"
    optional: true

- tapOn:
    point: "50%,15%"
    optional: true

# Wait for app to fully load
- extendedWaitUntil:
    visible:
      id: "chapter-selector-button"
    timeout: 30000

# ============================================
# Step 1: Navigate to Psalms 23 (Simulated Deep Link)
# ============================================

- tapOn:
    id: "chapter-selector-button"

- extendedWaitUntil:
    visible:
      id: "bible-navigation-modal"
    timeout: 5000

- tapOn:
    id: "tab-old-testament"

- waitForAnimationToEnd

# Scroll to find Psalms
- scroll
- scroll

- tapOn:
    id: "book-item-psalms"

- waitForAnimationToEnd

- scroll

- tapOn:
    id: "chapter-23"

- waitForAnimationToEnd

- extendedWaitUntil:
    notVisible:
      id: "bible-navigation-modal"
    timeout: 5000

# CHECKPOINT 1: Verify header shows Psalms 23
- assertVisible:
    text: "Psalms 23"
    timeout: 5000

# ============================================
# Step 2: Swipe Forward to Psalms 24
# ============================================

- swipe:
    direction: LEFT
    duration: 500

- waitForAnimationToEnd

# CHECKPOINT 2: Verify header shows Psalms 24
- assertVisible:
    text: "Psalms 24"
    timeout: 5000

# ============================================
# Step 3: Modal Jump to Exodus 20
# ============================================

- tapOn:
    id: "chapter-selector-button"

- extendedWaitUntil:
    visible:
      id: "bible-navigation-modal"
    timeout: 5000

- tapOn:
    id: "tab-old-testament"

- waitForAnimationToEnd

# Scroll up to find Exodus
- scrollUp
- scrollUp

- tapOn:
    id: "book-item-exodus"

- waitForAnimationToEnd

- scroll

- tapOn:
    id: "chapter-20"

- waitForAnimationToEnd

- extendedWaitUntil:
    notVisible:
      id: "bible-navigation-modal"
    timeout: 5000

# CHECKPOINT 3: Verify header shows Exodus 20
- assertVisible:
    text: "Exodus 20"
    timeout: 5000

# ============================================
# Step 4: Swipe Forward to Exodus 21
# ============================================

- swipe:
    direction: LEFT
    duration: 500

- waitForAnimationToEnd

# CHECKPOINT 4: Verify header shows Exodus 21
- assertVisible:
    text: "Exodus 21"
    timeout: 5000

# ============================================
# Step 5: Modal Jump to Matthew 5 (OT to NT)
# ============================================

- tapOn:
    id: "chapter-selector-button"

- extendedWaitUntil:
    visible:
      id: "bible-navigation-modal"
    timeout: 5000

- tapOn:
    id: "tab-new-testament"

- waitForAnimationToEnd

- tapOn:
    id: "book-item-matthew"

- waitForAnimationToEnd

- tapOn:
    id: "chapter-5"

- waitForAnimationToEnd

- extendedWaitUntil:
    notVisible:
      id: "bible-navigation-modal"
    timeout: 5000

# CHECKPOINT 5: Verify header shows Matthew 5
- assertVisible:
    text: "Matthew 5"
    timeout: 5000

# ============================================
# Step 6: Rapid Swipe Sequence
# ============================================

# 5 rapid forward swipes
- swipe:
    direction: LEFT
    duration: 200

- swipe:
    direction: LEFT
    duration: 200

- swipe:
    direction: LEFT
    duration: 200

- swipe:
    direction: LEFT
    duration: 200

- swipe:
    direction: LEFT
    duration: 200

- waitForAnimationToEnd

# CHECKPOINT 6: Verify header shows Matthew (should be around Matthew 10)
- assertVisible:
    text: "Matthew"
    timeout: 5000

# ============================================
# Step 7: Modal Jump After Rapid Swipes
# ============================================

- tapOn:
    id: "chapter-selector-button"

- extendedWaitUntil:
    visible:
      id: "bible-navigation-modal"
    timeout: 5000

- tapOn:
    id: "tab-new-testament"

- waitForAnimationToEnd

# Scroll to find John
- scroll

- tapOn:
    id: "book-item-john"

- waitForAnimationToEnd

- tapOn:
    id: "chapter-1"

- waitForAnimationToEnd

- extendedWaitUntil:
    notVisible:
      id: "bible-navigation-modal"
    timeout: 5000

# CHECKPOINT 7: Verify header shows John 1
- assertVisible:
    text: "John 1"
    timeout: 5000

# ============================================
# Step 8: Swipe, Then Immediate Modal Jump
# ============================================

- swipe:
    direction: LEFT
    duration: 500

- waitForAnimationToEnd

# CHECKPOINT 8a: Verify header shows John 2
- assertVisible:
    text: "John 2"
    timeout: 5000

# Immediately open modal and jump elsewhere
- tapOn:
    id: "chapter-selector-button"

- extendedWaitUntil:
    visible:
      id: "bible-navigation-modal"
    timeout: 5000

- tapOn:
    id: "tab-old-testament"

- waitForAnimationToEnd

- tapOn:
    id: "book-item-genesis"

- waitForAnimationToEnd

- tapOn:
    id: "chapter-1"

- waitForAnimationToEnd

- extendedWaitUntil:
    notVisible:
      id: "bible-navigation-modal"
    timeout: 5000

# CHECKPOINT 8b: Verify header shows Genesis 1
- assertVisible:
    text: "Genesis 1"
    timeout: 5000

# ============================================
# Step 9: Final Swipe Verification
# ============================================

# Forward swipe
- swipe:
    direction: LEFT
    duration: 500

- waitForAnimationToEnd

# CHECKPOINT 9a: Verify header shows Genesis 2
- assertVisible:
    text: "Genesis 2"
    timeout: 5000

# Backward swipe
- swipe:
    direction: RIGHT
    duration: 500

- waitForAnimationToEnd

# CHECKPOINT 9b: Verify header shows Genesis 1
- assertVisible:
    text: "Genesis 1"
    timeout: 5000

# ============================================
# Step 10: Circular Navigation in Combined Sequence
# ============================================

# Swipe backward from Genesis 1 (should wrap to Revelation 22)
- swipe:
    direction: RIGHT
    duration: 500

- waitForAnimationToEnd

# CHECKPOINT 10: Verify header shows Revelation 22
- assertVisible:
    text: "Revelation 22"
    timeout: 5000

# Swipe forward (should wrap to Genesis 1)
- swipe:
    direction: LEFT
    duration: 500

- waitForAnimationToEnd

# CHECKPOINT 11: Verify header shows Genesis 1
- assertVisible:
    text: "Genesis 1"
    timeout: 5000

# ============================================
# Step 11: Final Modal Jump to Verify State Integrity
# ============================================

- tapOn:
    id: "chapter-selector-button"

- extendedWaitUntil:
    visible:
      id: "bible-navigation-modal"
    timeout: 5000

- tapOn:
    id: "tab-new-testament"

- waitForAnimationToEnd

# Scroll to Revelation
- scroll
- scroll
- scroll

- tapOn:
    id: "book-item-revelation"

- waitForAnimationToEnd

- tapOn:
    id: "chapter-1"

- waitForAnimationToEnd

- extendedWaitUntil:
    notVisible:
      id: "bible-navigation-modal"
    timeout: 5000

# CHECKPOINT 12: Verify header shows Revelation 1
- assertVisible:
    text: "Revelation 1"
    timeout: 5000

# Final swipe verification
- swipe:
    direction: LEFT
    duration: 500

- waitForAnimationToEnd

# CHECKPOINT 13: Verify header shows Revelation 2
- assertVisible:
    text: "Revelation 2"
    timeout: 5000

# ============================================
# Test Complete
# ============================================

# Final stability check - ensure app is in working state
- assertVisible:
    id: "chapter-selector-button"

# Verify no skeleton loader is showing (content loaded)
- assertNotVisible:
    id: "skeleton-loader"
